let products_list = {
	"1": ['Бальзам СТАРЫЙ МАРИИНСК 0,5л 40% (Уссурийский бальзам) ШК 4603928000563', "300 RUB", "1"],
	"2": ['Вино "БОЖОЛЕ-ВИЛЯЖ АОС" 2015 защ. наим. места происх. красное сухое 0,75л 13% (Франция)', "7000 RUB", "7.7"],
	"3": [
		'Вино "БЭНРОК СТЕЙШН КАБЕРНЕ СОВИНЬОН" 2014 защ. геогр. указ. красное полусухое 0,75л 13% (Австралия)',
		"2400 RUB",
		"3.1"
	],
	"4": ['Вино "БЭНРОК СТЕЙШН КРАСНОЕ" столовое красное полусухое 0,75л 12,5% (Австралия)', "1100 RUB", "1.8"],
	"5": [
		'Вино "Бэнрок Стейшн Шардоне" 2014 защ. геогр. указ. белое полусухое 0,75л 13% (Австралия) (404)',
		"1200 RUB",
		"1.9"
	],
	"6": [
		'Вино "БЭНРОК СТЕЙШН ШИРАЗ" 2015 защ. геогр. указ. красное полусухое 0,75л 13,5% (Соед.Королевство)',
		"1300 RUB",
		"2"
	],
	"7": [
		'Вино "Вальполичелла ДОК Вилла Альберти" защ.наим.места происх.красное сухое 0,75л 11,5%(Италия)',
		"5100 RUB",
		"5.8"
	],
	"8": [
		'Вино "ДОН БАТИСТО КОСЕЧА" защ.наим.м.проис. красное сухое рег.Риоха кат.DOС 0,75л 13,5% (Испания)',
		"4300 RUB",
		"5"
	],
	"9": [
		'Вино "КАСТИЛЬО САНТА БАРБАРА ГРАН РЕЗЕРВА" защ.н.м.проис. красное сухое кат.D.O. 0,75л 13% (Испания)',
		"4200 RUB",
		"4.9"
	],
	"10": ['Вино "ЛА КОНСУЛЬТА ПИНО ГРИДЖИО" защ. геогр. указ. сухое белое 0,75л 13% (Аргентина)', "3200 RUB", "3.9"],
	"11": [
		'Вино "МАС РАБЕЛЛЬ КАТАЛОНИЯ ДО" 2015 защ. наим .м. происх. белое сухое 0,75л 11,5% (Испания)',
		"5000 RUB",
		"5.7"
	],
	"12": [
		'Вино "МАС РАБЕЛЛЬ КАТАЛОНИЯ ДО" защ. наим .м. происх. розовое сухое 0,75л 13,5% (Испания)',
		"4900 RUB",
		"5.6"
	],
	"13": [
		'Вино "НОБИЛОМО" МАРЦЕМИНО защ.н.м. пр. красное п/сладкое рег.Эмилия-Романья кат.DOC 0,75л 8%(Италия)',
		"4100 RUB",
		"4.8"
	],
	"14": [
		'Вино "Паяра Розато Апулия ИГТ" 2015 защ. геогр. указ. розовое полусухое 0,75л 11% (Италия)',
		"1400 RUB",
		"2.1"
	],
	"15": [
		'Вино "Соаве ДОК Вилла Альберти" защ. наим. места происх. белое сухое 0,75л 11,5% ( Италия)',
		"2700 RUB",
		"3.4"
	],
	"16": ['Вино "Ундуррага Шардоне" защ. геогр. указ. белое сухое 0,75л 13,5% (Чили)', "2900 RUB", "3.6"],
	"17": [
		'Вино "Чекки Орвьето Классико ДОКГ" защ. наим. места происх. сухое белое 0,75л 12,5% (Италия) (405)',
		"3100 RUB",
		"3.8"
	],
	"18": [
		'Вино "Шато дю Корне Бордо АОС" 2014 защ. наим. места происх. белое сухое 0,75л 12% (Франция) (405)',
		"2800 RUB",
		"3.5"
	],
	"19": [
		'Вино "Шато Ле Гранд Винь Антр-Де-Мер АОС" 2015 защ.наим.м.происх. белое сухое 0,75л 12% (Франция)',
		"2500 RUB",
		"3.2"
	],
	"20": [
		'Вино "ШАТО ЛЮСЬЕР БОРДО АОС" 2014 защ. наим. места происх. красное сухое 0,75л 12,5 % (Франция)',
		"5200 RUB",
		"5.9"
	],
	"21": [
		'Вино "Шато Пикар Бордо АОС" 2015 защ.наим.места происх. красное сухое 0,75л 12,5% (Франция)',
		"2600 RUB",
		"3.3"
	],
	"22": [
		'Вино Боттер Соаве защ. наим. места происх. белое сухое кат.DOC рег.Венето 0,75л 12% (Италия)',
		"1900 RUB",
		"2.6"
	],
	"23": [
		'Вино Вилла Альба Пино Гриджио 2015 защ.геогр. указ. белое сухое кат.IGT рег.Пулия 0,75л 12% (Италия)',
		"5300 RUB",
		"6"
	],
	"24": [
		'Вино ВИСТАФЛОР СОВИНЬОН БЛАН-ШЕНЭН 2015 защ. геогр. указ. белое сухое рег.Мендоса 0,75л 13%',
		"5900 RUB",
		"6.6"
	],
	"25": ['Вино игристое "МАРТИНИ ПРОСЕККО" геогр. указ. сухое белое кат.D.O.C. 0,2л 11,5% (Италия)', "1700 RUB", "2.4"],
	"26": [
		'Вино игристое "МАРТИНИ ПРОСЕККО" геогр. указ. сухое белое кат.D.O.C. 0,75л 11,5% (Италия)',
		"2000 RUB",
		"2.7"
	],
	"27": [
		'Вино игристое Кава Лар де Плата Брют защ. наим. места происх. белое брют рег.Эстремадура 0,75л 11,5%',
		"1800 RUB",
		"2.5"
	],
	"28": ['Вино ИЗАБЕЛЛА столовое полусладкое красное 2л*6 10-12% /Фанагория/', "6700 RUB", "7.4"],
	"29": ['Вино КАБЕРНЕ столовое сухое красное 2,0л*6 11-13% /Фанагория/', "2300 RUB", "3"],
	"30": ['Вино ЛЕ КОЛОМБЬЕР столовое белое полусладкое 0,75л 11% (Франция)', "5700 RUB", "6.4"],
	"31": ['Вино ЛЕ КОЛОМБЬЕР столовое белое сухое 0,75л 11% (Франция)', "5500 RUB", "6.2"],
	"32": ['Вино ЛЕ КОЛОМБЬЕР столовое красное полусладкое 0,75л 11% (Франция)', "5800 RUB", "6.5"],
	"33": ['Вино ЛЕ КОЛОМБЬЕР столовое красное сухое 0,75л 11% (Франция)', "5600 RUB", "6.3"],
	"34": [
		'Вино ликерное КОКБЕРНС 10 ТОНИ ПОРТ защ.наим. места проис. рег.Долина Дору кат.DOC выдерж. 0,75л 20%',
		"3500 RUB",
		"4.2"
	],
	"35": [
		'Вино ликерное КОКБЕРНС 20 ТОНИ ПОРТ защ. наим. места проис. рег.Долина Дору кат.DOC выдерж. 0,5л 20%',
		"3700 RUB",
		"4.4"
	],
	"36": [
		'Вино ликерное КОКБЕРНС ЛЕЙТ БОТТЛД ВИНТАЖ ПОРТ защ.наим.м.проис. р.Долина Дору к.DOC выдер 0,75л 20%',
		"3600 RUB",
		"4.3"
	],
	"37": [
		'Вино ликерное КОКБЕРНС ФАЙН ВАЙТ ПОРТ защ.наим.места проис. выдерж. 0,75л 19% р.Долина Дору кат.DOC',
		"3800 RUB",
		"4.5"
	],
	"38": [
		'Вино Маркес де Касерес Бланко 2016 защ.наим.мест.происх. белое сухое кат.DOC рег.Риоха 0,75л 12,5%',
		"3400 RUB",
		"4.1"
	],
	"39": [
		'Вино Пондерадо Тинто 2016 защ. геогр. указания красное сухое рег.Центральная Долина 0,75л*12 12%',
		"400 RUB",
		"1.1"
	],
	"40": [
		'Вино САЛИДА КАБЕРНЕ СОВИНЬОН защ.наим.м.пр. сухое красное рег.Канелонес кат.VCP 0,75л 12,5%(Уругвай)',
		"700 RUB",
		"1.4"
	],
	"41": ['Вино ФАЛЬКОНАРДИ БЬЯНКО столовое белое полусладкое 0,75л 10% (Италия)', "5400 RUB", "6.1"],
	"42": ['Вино ФАЛЬКОНАРДИ РОССО столовое красное полусладкое 0,75л 10,5% (Италия)', "6900 RUB", "7.6"],
	"43": [
		'Вино ШАТО БЕЛЬГРАВ защ.наим.м.происх. сухое красное кат.АОС рег.Медок 0,75 13% (Франция) (405)',
		"4400 RUB",
		"5.1"
	],
	"44": [
		'Вино Шато Нодо 2014 защ. наим. места происх. красное сухое кат.АОС рег.Бордо 0,75л 11,5% (Фран)(402)',
		"6800 RUB",
		"7.5"
	],
	"45": ['Вино ШЕВАЛЬЕ ДЕ ПЬЕР МЕРЛО столовое красное сухое 0,75л крепость 12,5 об.% (Франция)', "500 RUB", "1.2"],
	"46": [
		'Вино Эхо Фоллс Уайт Зинфандель 2015 защ.геогр. указания розовое полусладкое рег.Калифорния 0,75л 10%',
		"3300 RUB",
		"4"
	],
	"47": ['Виски купажированный "Вильям Лоусонс" 0,5л 40% (Россия, Традиции Качества)', "3900 RUB", "4.6"],
	"48": [
		'Виски шотландский односолодовый "ГЛЕНМОРАНДЖИ ЛАСАНТА" выдержка 12 лет 0,7л в п/у 43% (237)',
		"6400 RUB",
		"7.1"
	],
	"49": [
		'Виски шотландский односолодовый "ГЛЕНМОРАНДЖИ ОРИДЖИНАЛ" выдержка 10 лет 0,7л в п/у 40% (237)',
		"6300 RUB",
		"7"
	],
	"50": ['Водка "ВЫСОТА PREMIUM ЛЮКС на ледниковой воде" 0,5л 40% (Старооскольский ЛВЗ Люкс)', "1000 RUB", "1.7"],
	"51": [
		'Водка "КЛАССИЧЕСКАЯ ПУТИНКА МЯГКАЯ (CLASSIC PUTINKA SOFT)" 0,5л 40% (АО Московский завод Кристалл)',
		"600 RUB",
		"1.3"
	],
	"52": ['Водка БЕЛЕНЬКАЯ 1,0л 40% (АО АЛВИЗ)', "1500 RUB", "2.2"],
	"53": ['Водка особая БАЙКАЛ КЛЮКВА 0,5л 40% (Юпитер Инкорпорейтед)', "900 RUB", "1.6"],
	"54": ['Водка особая СЛАВЯНСКАЯ РЖАНАЯ ИЗ ОТБОРНОЙ РЖИ 0,25л 40% (Юпитер Инкорпорейтед)', "800 RUB", "1.5"],
	"55": [
		'Коньяк "ХЕННЕССИ ВС (HENNESSY VS)" выдержка 3 года 0,2л 40% (Франция) (Моет Хеннесси Рус)',
		"6100 RUB",
		"6.8"
	],
	"56": [
		'Коньяк "ХЕННЕССИ ВС" выдержка 3 года 0,7л 40% об. (светящаяся бутылка) (Франция) (Моет Хеннеси Рус)',
		"6200 RUB",
		"6.9"
	],
	"57": ['Коньяк армянский "ШИРАЗ" выдержка 5 лет 0,5л 40% (Прошянский кз, ВинЛэнд)', "6000 RUB", "6.7"],
	"58": ['Коньяк грузинский "САРАДЖИШВИЛИ ХО" выдержка 10 лет (в п/уп) в с/бут 0,35л 40% (Грузия)', "6500 RUB", "7.2"],
	"59": ['Коньяк грузинский "САРАДЖИШВИЛИ ХО" выдержка 10 лет (в п/уп) в с/бут 0,7л 40% (Грузия)', "6600 RUB", "7.3"],
	"60": ['Ликер "ДЖАРОЛА КРЕМ ДЕ КАССИС" 0,7л 17% (Италия) КПП 780245001', "2100 RUB", "2.8"],
	"61": ['Ликер десертный "БОЛС ПИЧ" со вкусом персика и апельсина 0,7л 17% (Нидерланды)', "4000 RUB", "4.7"],
	"62": ['Настойка горькая "КЕДРОВАЯ ПАДЬ" 0,5л*20 РС14-2 45% (Уссурийск)', "2200 RUB", "2.9"],
	"63": ['Ром БОТУКАЛЬ АНЬЕХО выдержка 4 года 0,7л 40% (Венесуэла)', "1600 RUB", "2.3"],
	"64": ['Российский коньяк выдержанный "КВ" "Лезгинка" 0,25л 40% (ФГУП "ККЗ")', "3000 RUB", "3.7"],
	"65": ['Российский коньяк пятилетний "СТАРЫЙ РУССКИЙ ДУБ" 0,5л 40% /Фанагория/', "4500 RUB", "5.2"],
	"66": [
		'Российское шампанское "БЛАН ДЕ НУАР" выдержанное экстра брют белое 0,75л 12% (Лазурная Ягода)',
		"4600 RUB",
		"5.3"
	],
	"67": [
		'Российское шампанское "БЛАН ДЕ НУАР" выдержанное экстра брют белое 1,5л 12% (Лазурная Ягода)',
		"4800 RUB",
		"5.5"
	],
	"68": [
		'Российское шампанское "ГРАНД КЮВЕ" выдержанное экстра брют белое 0,75л 12% (Лазурная Ягода)',
		"4700 RUB",
		"5.4"
	],
};

let delay = 15000; //задержка

let scrollDelay = 20000;

let products_to_cart = 4; // количество товаров в корзине

let click_count_plus = 4; // количество кликов на плюсик

let click_count_minus = 2; // количество кликов на минусик

let count_to_delete = 1;

let days_for_delivery = 3; //количество дней для ожидания доставки

module.exports = {
	before: function (browser) {
		console.log('Begining test DEV-1634...');
	},

	after: function (browser) {
		console.log('Finishing test DEV-1634...');
		browser.end();
	},

	'Test DEV-1634 order operations': function (browser) {
		let commonOperations = require("./commonoperations");

		// let array_length = browser.globals.vars.length_array;

		browser.url('http://dev.mixcart.ronasit.com/login', () => {
			console.log('Loading http://dev.mixcart.ronasit.com/login...');
		});
		browser.waitForElementVisible('#email', delay, function () {
			console.log('email input appeared...');
		});
		browser.waitForElementVisible('#password', delay, function () {
			console.log('password input appeared...');
		});
		browser.waitForElementVisible('.dropdown-trigger', delay, function () {
			console.log('drop-down trigger appeared appeared...');
		});
		browser.click('.dropdown-trigger');
		browser.click('.dropdown-content a:nth-child(1)');

		browser.setValue('#email', 'mixcart@bk.ru');
		browser.setValue('#password', 'max999');
		browser.expect.element('#email').to.have.value.that.equals('mixcart@bk.ru').before(delay);
		browser.expect.element('#password').to.have.value.that.equals('max999').before(delay);
		browser.submitForm('form');

		browser.expect.element('h3[class="guest-form-title"]').text.to.equal('Ваш бизнес-профиль').before(delay);

		browser.waitForElementVisible('.guest-form-fields a:nth-child(1)', delay, function (result) {
			console.log('Mo\'s bar appeared...');
		});

		browser.click('.guest-form-fields a:nth-child(1)');

		browser.waitForElementVisible('.header-profile-name', delay, function (result) {
			console.log('.header-profile-name appeared...');
		});

		browser.url('http://dev.mixcart.ronasit.com/client/create-order/my-supplier-goods', () => {
			console.log('Loading http://dev.mixcart.ronasit.com/client/create-order/my-supplier-goods...');//Переходим на
		                                                                                                 // страницу
		                                                                                                 // заказов
		});

		browser.resizeWindow(1980, 1080);

		// browser.pause(3000);

		browser.waitForElementVisible('.filters .filter-sort', delay);

		browser.saveScreenshot('tessstt.png');

		browser.perform(function () {
			console.log('trying to scroll down....please wait...');
		});

		for (let i = 0; i < 7; i++) {
			browser.execute(function () {
				window.scrollBy(0, 10000);
			}, []);
			browser.pause(delay);
		}

		// operations in the cart test

		browser.elements('css selector', 'app-product-list table tbody tr', function (res) {
			console.log('row count: ' + res.value.length);
			browser.verify.equal(res.value.length, Object.keys(products_list).length);
		});

		browser.resizeWindow(1980, 7000);
		browser.saveScreenshot('tesssstttt___full llist.png');
		browser.resizeWindow(1980, 1080);

		function test_adding_products_to_cart(b, array, product_count, longDelay) {

			b.element('css selector', 'body', function () {
				console.log('Adding products to cart');
			});

			let i = 0;

			let price_sum = 0;

			for (let key in array) {
				i++;
				if (i > product_count) {
					break;
				}

				b.click('app-product-list table tbody tr:nth-child(' + key + ') td:nth-child(6) .quantity-plus', function () {
					console.log('tried to add a product');
				});

				b.pause(parseInt(longDelay / 2));

				let cart_key = Number(key);

				b.waitForElementVisible('.cart-contents app-order .cart-item:nth-child(' + String(cart_key + 1) + ')', longDelay * 2);

				b.perform(function () {
					console.log('product №' + key + ' added');
					console.log('its multiplicity is ' + array[key][2]);
				});

				b.saveScreenshot('product_add_' + key + '.png');

				let r_products_in_cart = new RegExp("^" + String(i) + "");

				price_sum += parseInt(parseFloat(array[key][1]) * parseFloat(array[key][2]));

				let r_total_price = new RegExp("^" + String(price_sum) + '\\sRUB$');

				b.expect.element('app-cart .cart .cart-total div').text.to.match(r_products_in_cart).before(parseInt(longDelay * 2));
				b.expect.element('app-cart .cart .cart-total div strong').text.to.match(r_total_price).before(2 * longDelay);

				b.pause(parseInt(delay / 3));

				b.verify.attributeEquals('app-product-list table tbody tr:nth-child(' + key + ') td:nth-child(6) input', 'value', array[key][2]);

				b.verify.containsText('app-order .cart-item:nth-child(' + String(cart_key + 1) + ') .cart-item-title', array[key][0]);

				b.verify.attributeEquals('app-order .cart-item:nth-child(' + String(cart_key + 1) + ') input', 'value', array[key][2]);

			}

			browser.resizeWindow(1980, 7000);
			b.saveScreenshot('cart_with_products.png');
			browser.resizeWindow(1980, 1080);

			return price_sum;
		}

		function test_checkout_products(b, product_list, checkout_size, delay) {
			for (let i = 1; i <= checkout_size; ++i) {
				b.waitForElementPresent('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ')', delay, true, function () {
					console.log('product appeared...');
				});
				//Проверяем название продукта
				b.verify.containsText('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ') td:nth-child(1)', product_list[String(i)][0]);
				//Проверяем его количество
				b.verify.attributeEquals('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ') .table-quantity input', 'value', product_list[String(i)][2]);
				//Проверяем его стоимость
				b.verify.containsText('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ') .table-price', product_list[String(i)][1]);
				//Проверяем суммарную стоимость
				let total_sum = String(parseFloat(product_list[String(i)][1]) * parseFloat(product_list[String(i)][2])) + ' RUB';
				b.verify.containsText('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ') .table-sum', total_sum);
			}
		}

		function test_checkout_plus_minus_operation(b, product_list, checkout_size, operation_button, click_count_plus, click_count_minus, delay) {
			if (click_count_plus < click_count_minus) {
				return false;
			}
			let checkout_sum = 0;
			let total_sum;
			let click_count;
			let multiplicity_sum;
			if (operation_button === '.quantity-plus') {
				click_count = click_count_plus;
			} else if (operation_button === '.quantity-minus') {
				click_count = click_count_minus;
			} else {
				return false;
			}
			for (let i = 1; i <= checkout_size; ++i) {
				for (let j = 1; j <= click_count; j++) {
					b.click('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ') .table-quantity ' + operation_button);
					b.pause(parseInt(delay / 10));
				}
				//Проверяем суммарную стоимость и кратность
				if (operation_button === '.quantity-plus') {
					total_sum = String((click_count_plus + 1) * parseFloat(product_list[String(i)][1]) * parseFloat(product_list[String(i)][2])) + ' RUB';
					multiplicity_sum = String((click_count_plus + 1) * parseFloat(product_list[String(i)][2]));
				} else if (operation_button === '.quantity-minus') {
					total_sum = String((click_count_plus - click_count_minus + 1) * parseFloat(product_list[String(i)][1]) * parseFloat(product_list[String(i)][2])) + ' RUB';
					multiplicity_sum = String((click_count_plus - click_count_minus + 1) * parseFloat(product_list[String(i)][2]));
				} else {
					break;
				}
				checkout_sum += parseInt(total_sum);
				b.verify.containsText('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ') .table-sum', total_sum);
				b.verify.attributeEquals('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ') .table-quantity input', 'value', multiplicity_sum);
			}
			return checkout_sum;
		}

		function test_checkout_product_input_operation(b, array, product_count) {
			b.element('css selector', 'body', function () {
				console.log('Testing random inputs in the order...');
			});

			// function expected_input(multiplicity, my_input) {
			//
			//     let n = parseInt(String(my_input / multiplicity));
			//
			//     if (n === 0) {
			//         return multiplicity;
			//     }
			//
			//     let n_multiplicity = n * multiplicity;
			//
			//     let diff = my_input - n_multiplicity;
			//
			//     // console.log(diff)
			//
			//     if (diff >= (multiplicity / 2)) {
			//         // console.log('1');
			//         return Math.round(parseFloat(String((n + 1) * multiplicity)) * 100) / 100;
			//     } else {
			//         // console.log('2');
			//         return Math.round(String(n_multiplicity) * 100) / 100;
			//     }
			// }

			// function getRandomInt(min, max) {
			//     return Math.floor(Math.random() * (max - min)) + min;
			// }

			let total_sum = 0;

			for (let i = 1; i <= product_count; ++i) {

				b.pause(1000);

				let randInput = String(commonOperations.getRandomInt(10, 30));

				b.perform(function () {
					console.log('rand value = ' + randInput);
					console.log('multiplicity = ' + array[String(i)][2]);
				});

				b.clearValue('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ') .table-quantity input', function () {
					console.log('clearing input value...');
				});

				b.pause(1000);

				b.setValue('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ') .table-quantity input', [
					randInput,
					b.Keys.ENTER
				], function (res) {
					console.log('setting random value...');
				});

				b.pause(1000);

				b.verify.attributeEquals('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ') .table-quantity input', 'value', String(expected_input(Number(array[String(i)][2]), Number(randInput))));

				let product_sum = parseFloat(commonOperations.expected_input(Number(array[String(i)][2]), Number(randInput))) * parseFloat(array[String(i)][1]);

				total_sum += product_sum;

				b.verify.containsText('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ') .table-sum', String(product_sum) + ' RUB');

				b.pause(1000);
			}
			b.saveScreenshot('random_values_set.png');
			return total_sum;
		}

		function test_checkout_comments(b, checkout_size, comment_text, delay) {
			for (let i = 1; i <= checkout_size; ++i) {
				b.click('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ') .table-comment a');
				b.waitForElementVisible('app-comment-modal .popup-overlay .popup-form', delay, true, function () {
					console.log('comment form for product ' + i + ' appeared');
				});
				b.pause(2000);
				b.setValue('app-comment-modal .popup-overlay .popup-form form textarea', comment_text);
				b.pause(1000);
				b.verify.attributeEquals('app-comment-modal .popup-overlay .popup-form form textarea', 'value', comment_text);
				b.click('app-comment-modal .popup-overlay .popup-form form a', function () {
					console.log('adding comment to product ' + i);
				});
				b.waitForElementNotPresent('app-comment-modal .popup-overlay .popup-form', delay, true, function () {
					console.log('comment form for product ' + i + ' disappeared');
				});
				b.pause(3000);
				b.verify.containsText('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ') .table-comment .checkout-comment-text', comment_text);
				b.saveScreenshot('comment_' + i + '.png');
				// browser.expect.element('.checkout-table-goods table tbody tr:nth-child(' + String(i) + ') .table-comment
				// .checkout-comment-text').text.to.equal(comment_text).before(2*delay);
			}
			b.saveScreenshot('comments_added.png');
			b.click('.checkout-table-supplier .checkout-comments a', function () {
				console.log('clicking on order comment link...')
			});
			b.waitForElementVisible('app-comment-modal .popup-overlay .popup-form', delay, true, function () {
				console.log('order comment form appeared...');
			});
			b.setValue('app-comment-modal .popup-overlay .popup-form form textarea', comment_text);
			b.pause(1000);
			b.verify.attributeEquals('app-comment-modal .popup-overlay .popup-form form textarea', 'value', comment_text);
			b.click('app-comment-modal .popup-overlay .popup-form form a', function () {
				console.log('adding order comment...');
			});
			b.waitForElementNotPresent('app-comment-modal .popup-overlay .popup-form', delay, true, function () {
				console.log('comment order form for product disappeared...');
			});
			b.pause(3000);
			b.verify.containsText('.checkout-table-supplier .checkout-comments .checkout-comments-value', comment_text);
			b.saveScreenshot('all_comments_added.png');

		}

		function test_delivery_date(b, days_to_wait, delay) {
			function zeroBeforeMonth(m) {
				let mArray = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11'];
				if (!(m in mArray)) {
					return false;
				}
				let intM = parseInt(m);
				++intM;
				if (intM <= 9) {
					return '0' + String(intM);
				} else return m;
			}

			b.waitForElementPresent('.checkout-table-supplier .checkout-date a', delay, true, function () {
				console.log('the button to set delivery date is here...');
			});

			let current_date = new Date();

			let current_day = current_date.getDate();

			current_date.setDate(1);

			let first_weekday_this_month = current_date.getDay();

			current_date.setDate(current_day + days_to_wait);

			let delivery_day = current_date.getDate();

			let delivery_day_weekday = current_date.getDay();

			let n_row, n_col;

			let days_begin = [1, 7, 6, 5, 4, 3, 2];
			let days_end = [7, 1, 2, 3, 4, 5, 6];

			if (delivery_day <= days_begin[first_weekday_this_month]) {
				n_row = 1;
			} else if (delivery_day >= (days_begin[first_weekday_this_month]) && delivery_day <= (days_begin[first_weekday_this_month] + days_end[delivery_day_weekday])) {
				n_row = 2;
			} else {
				n_row = 2 + parseInt((delivery_day - days_begin[first_weekday_this_month] - days_end[delivery_day_weekday]) / 7);
			}
			if (current_date.getDay() === 0) {
				n_col = 7;
			} else {
				n_col = current_date.getDay();
			}
			b.element('css selector', 'body', function () {
				console.log('n_row=' + n_row);
				console.log('n_col=' + n_col);
			});
			b.click('.checkout-table-supplier .checkout-date a');
			b.pause(2000);
			b.saveScreenshot('date_button_clicked.png');
			b.click('.checkout-table-supplier .checkout-date .datepicker table tr:nth-child(' + n_row + ') td:nth-child(' + n_col + ')');
			b.pause(2000);
			b.saveScreenshot('delivery_date_clicked.png');
			b.click('.checkout-table-supplier .checkout-date a');
			b.pause(3000);
			let strDate = delivery_day + '.' + zeroBeforeMonth(current_date.getMonth()) + '.' + current_date.getFullYear();
			b.element('css selector', 'body', function () {
				console.log('delivery date = ' + strDate);
			});
			b.verify.containsText('.checkout-table-supplier .checkout-date strong', strDate);
			b.saveScreenshot('date_button_clicked_again.png');
			b.pause(2000);
		}

		let price_sum = test_adding_products_to_cart(browser, products_list, products_to_cart, delay);

		browser.waitForElementVisible('app-cart .cart-buttons div:nth-child(2) a', delay);

		browser.click('app-cart .cart-buttons div:nth-child(2) a', function () {
			console.log('we will try to form our order now...')
		});

		browser.pause(delay);

		browser.waitForElementVisible('app-checkout .checkout .checkout-head h1', delay);

		browser.expect.element('app-checkout .checkout-head h1').text.to.match(/^Оформление\sзаказа/).before(delay);

		let r_total_sum = new RegExp('^' + String(price_sum) + ' RUB$');

		browser.expect.element('app-checkout .checkout-sum strong').text.to.match(r_total_sum).before(delay);

		browser.element('css selector', 'body', function () {
			console.log('checking order content...');
		});

		test_checkout_products(browser, products_list, products_to_cart, delay);

		browser.element('css selector', 'body', function () {
			console.log('testing plus operation...');
		});

		let sum_plus = test_checkout_plus_minus_operation(browser, products_list, products_to_cart, '.quantity-plus', click_count_plus, click_count_minus, delay);

		let r_total_plus_sum = new RegExp('^' + String(sum_plus) + ' RUB$');

		browser.expect.element('app-checkout .checkout-sum strong').text.to.match(r_total_plus_sum).before(delay);

		browser.element('css selector', 'body', function () {
			console.log('testing minus operation...');
		});

		let sum_minus = test_checkout_plus_minus_operation(browser, products_list, products_to_cart, '.quantity-minus', click_count_plus, click_count_minus, delay);

		let r_total_minus_sum = new RegExp('^' + String(sum_minus) + ' RUB$');

		browser.expect.element('app-checkout .checkout-sum strong').text.to.match(r_total_minus_sum).before(delay);

		browser.element('css selector', 'body', function () {
			console.log('testing operation with product inputs...');
		});

		let sum_input = test_checkout_product_input_operation(browser, products_list, products_to_cart);

		let r_total_input_sum = new RegExp('^' + String(sum_input) + ' RUB$');

		// browser.expect.element('app-checkout .checkout-sum strong').text.to.match(r_total_input_sum).before(delay);

		browser.element('css selector', 'body', function () {
			console.log('testing operation with product comments...');
		});

		test_checkout_comments(browser, products_to_cart, 'test', delay);

		test_delivery_date(browser, days_for_delivery, delay);

		//end

		browser.refresh();

		browser.expect.element("span[class='header-profile-name']").text.to.equal('Mo\'s').before(delay);

		browser.pause(2000);
		browser.click("span[class='header-profile-name']");
		browser.click("a[class='button-link header-user-logout']");
		browser.expect.element("h3[class='guest-form-title']").text.to.equal('Добро пожаловать').before(delay); //Ждём пока
	                                                                                                          // не
	                                                                                                          // выйдем
	},

	// 'Test DEV-1632 clear cart': function (browser) {
	//
	//     // let array_length = browser.globals.vars.length_array;
	//
	//     browser.url('http://dev.mixcart.ronasit.com/login', () => {
	//         console.log('Loading http://dev.mixcart.ronasit.com/login...');
	//     });
	//     browser.waitForElementVisible('#email', 7000, function () {
	//         console.log('email input appeared...');
	//     });
	//     browser.waitForElementVisible('#password', 7000, function () {
	//         console.log('password input appeared...');
	//     });
	//     browser.waitForElementVisible('.dropdown-trigger', 7000, function () {
	//         console.log('drop-down trigger appeared appeared...');
	//     });
	//     browser.click('.dropdown-trigger');
	//     browser.click('.dropdown-content a:nth-child(1)');
	//
	//     browser.setValue('#email', 'mixcart@bk.ru');
	//     browser.setValue('#password', 'max999');
	//     browser.expect.element('#email').to.have.value.that.equals('mixcart@bk.ru');
	//     browser.expect.element('#password').to.have.value.that.equals('max999');
	//     browser.submitForm('form');
	//
	//     browser.expect.element('h3[class="guest-form-title"]').text.to.equal('Ваш бизнес-профиль').after(5000);
	//
	//     browser.click('.guest-form-fields a:nth-child(1)');
	//
	//     browser.waitForElementVisible('.header-profile-name', 7000, function (result) {
	//         console.log('.header-profile-name appeared...');
	//     });
	//
	//     browser.url('http://dev.mixcart.ronasit.com/client/create-order/my-supplier-goods', () => {
	//         console.log('Loading http://dev.mixcart.ronasit.com/client/create-order/my-supplier-goods...');//Переходим
	// на страницу заказов });  browser.resizeWindow(1980, 5000);  browser.pause(3000);
	// browser.waitForElementVisible('.filters .filter-sort', 7000);  browser.saveScreenshot('tessstt.png');   //cart
	// clear test for (let i = 0; i < 3; i++) { browser.pause(10000); browser.waitForElementVisible('app-cart .cart
	// .cart-head .cart-buttons .button-red', 7000, function () { console.log('clear cart button appeared...'); });
	// browser.waitForElementVisible('app-cart .cart .cart-head .cart-buttons .button-red', 7000, function () {
	// console.log('clear cart button appeared...'); }); browser.click('app-cart .cart .cart-head .cart-buttons
	// .button-red'); browser.pause(10000); browser.waitForElementVisible('app-cart .cart .cart-empty', 7000, function ()
	// { console.log('empty cart appeared...') }); browser.saveScreenshot('empty.cart.' + i + '.png'); browser.refresh();
	// } //end  browser.pause(5000);
	// browser.expect.element("span[class='header-profile-name']").text.to.equal('Mo\'s').before(10000);
	// browser.pause(2000); browser.click("span[class='header-profile-name']"); browser.click("a[class='button-link
	// header-user-logout']"); browser.expect.element("h3[class='guest-form-title']").text.to.equal('Добро
	// пожаловать').before(10000); //Ждём пока не выйдем },
};
